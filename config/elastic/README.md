# Elastic

This folder holds the configuration file for the SIEM platform in question. All SIEM platform folders have the following structure:

- Example use cases of SIEGMA
- Fields & Configurations
- Automatic upload

## Example use cases of SIEGMA

### Generate an Elastic SIEM output from a single Sigma rule file

`python siegma.py -c config/elastic/elastic-siem.json -r /path/to/rule.yml -sc /path/to/sigma/config/file/sigma/tools/config/file.yml -o rule_output.ndjson`

### Generate an Elastic SIEM output from a folder with several Sigma rule files and automatic uploading the rules into elastic

`python siegma.py -c config/elastic/elastic-siem.json -r /path/to/folder/with/sigma-rules/ -sc /path/to/sigma/config/file/sigma/tools/config/file.yml -api`

An example where we utilize our [AWS CloudTrail Sigma configuration](https://blog.3coresec.com/2020/05/contributions-to-sigma-cloudtrailecs.html) to convert a single rule to Elastic SIEM output:

`python siegma.py -c config/elastic/elastic-siem.json -r rules/cloudtrail_rule.yml -sc sigma/tools/config/ecs-cloudtrail.yml -o rule_output.ndjson`

## Elastic SIEM Configuration & Data Dictionary

| Elastic SIEM Config Field | Default Value         | Field type                 | Description                                                                                                                                                                                                                                                                                                                                         |
| ------------------------- | --------------------- | -------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| username           | No default value      | User input optional        | Enables automatic rule upload if filled                                                                                                                                                                                                                                                                                                             |
| password           | No default value      | User input optional        | Enables automatic rule upload if filled                                                                                                                                                                                                                                                                                                             |
 siem_url           | No default value      | Elastic URL        | Enables automatic rule import if filled (i.e http://my_kibana:5601)                                                                                                                                                                                                                                                                                                             |
  apikey           | No default value      | Elastic apikey        | In this version, these specific parameters do not need to be passed in the configuration file.                                                                                                                                                                                                                                                                                                            |
| rule_id                   | No default value      | Sigma: id                  | Rule identifier                                                                                                                                                                                                                                                                                                                                     |
| id                        | No default value      | Sigma: id                  | Rule identifier                                                                                                                                                                                                                                                                                                              
| actions                    | No default value or []      | Sigma: Elastic actions              | Rule actions as supported by Elastic                                                                                                                                                                                                                                                                                                                                         |                       |
| author                    | No default value      | Sigma: author              | Rule author, By default, it is loaded from the Sigma rule itself and do not need to be explicitly specified in the configuration file.                                                                                                                                                                                                                                                                                                                                    |
| from                      | now-15m               | Sigma: timeframe           | Defines how much data in the past should be queried. Example: now-15m                                                                                                                                                                                                                                                                               |
| index                     | ["*"]                 | User input needed          | Define the indexes that should be queried. Example: filebeat-\*                                                                                                                                                                                                                                                                                     |
| interval                  | 5m                    | User input needed          | Define how often the rule should run in Elastic SIEM                                                                                                                                                                                                                                                                                                |
| language                  | lucene                 | Hardcoded                  | Default value used by Elastic for lucene.                                                                                                                                                                                                                                                 |
| output_index              | .siem-signals-default | Hardcoded                  | Default index used by Elastic SIEM                                                                                                                                                                                                                                               
| note                      | No default value      | Sigma: note                | Contains relative path (from notes_folder) to a .md (markdown formatted) file with details for investigation guide / notes for a given detection use case. Optional field that can be set in config or rule.yml file. Settings in rule.yml take precedence over settings in config.                                                                 |
| query                     | No default value      | Hardcoded                  | Comes from the result of running sigmac                                                                                                                                                                                                                                                                                                             |
| to                        | now                   | Hardcoded                  | Preset field and value. Don't change                                                                                                                                                                                                                                                                                                                |
| type                      | query                 | Hardcoded                  | Preset field and value. Don't change                                                                                                                                                                                                                                                                                                                |
| threat                    | No default value      | Sigma: tags                | ATT&CK mapping                                                                                                                                                                                                                                                                                                                                      |
| throttle                  | no_actions            | Hardcoded                  | Preset field and value. Don't change                                                                                                                                                                                                                                                                                                                |